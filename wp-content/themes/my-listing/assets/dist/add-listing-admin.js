!function(e){"function"==typeof define&&define.amd?define("addListingAdmin",e):e()}(function(){"use strict";function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,a,o,r,d=[],l=!0,s=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=o.call(n)).done)&&(d.push(i.value),d.length!==t);l=!0);}catch(e){s=!0,a=e}finally{try{if(!l&&null!=n.return&&(r=n.return(),Object(r)!==r))return}finally{if(s)throw a}}return d}}(e,t)||function(e,t){var n;if(e)return"string"==typeof e?i(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}jQuery(function(s){var c,p,f,u;s(".file-upload-field.multiple-uploads .job-manager-uploaded-files").sortable({helper:"clone",appendTo:document.body}),s('.c27-work-hours .day-wrapper .work-hours-type input[type="radio"]').on("change",function(e){s(this).val();s(this).parents(".day-wrapper").removeClass(["day-status-enter-hours","day-status-closed-all-day","day-status-open-all-day","day-status-by-appointment-only"].join(" ")).addClass("day-status-"+s(this).val())}),s(".form-group .c27-work-hours, .ml-admin-listing-form .c27-work-hours").length&&(u=[],s(".form-group .c27-work-hours, .ml-admin-listing-form .c27-work-hours").each(function(){c=s(this)}),c.find(".copy-schedule").on("click",function(e){e.preventDefault(),s(this).siblings(".copy-hours-wrapper").toggleClass("hidden"),p=c.find(".work-hours-message").val(),f=c.find(".work-hours-message").attr("nodays")}),c.find(".copy-hours-wrapper .md-checkbox").each(function(e,t){s(t).find("input").on("change",function(){var e,t,n;s(this).is(":checked")?(e=s(this).data("day"),t=s(this).siblings("label").html(),(n={})[e]=t,u.push(n)):u.splice(u.indexOf(s(this).data("day")),1)})}),c.find(".copy-confirm").on("click",function(e){if(e.preventDefault(),u.length){for(var t="",n=0,i=u;n<i.length;n++)for(var a=i[n],o=0,r=Object.entries(a);o<r.length;o++){var d=h(r[o],2),l=d[0],d=d[1];!function(e){var t,n=s(".days .nav-tabs > li.active").find("a").attr("aria-controls"),i=s("#"+n).find(".work-hours-type > div input:checked").val(),e=s.isNumeric(e)||"all"!==e?s(".days .nav-tabs > li").eq(e-1):s(".days .nav-tabs > li:not(.active)"),a=[];"enter-hours"===i&&(n=s("#"+n).find(".work-hours-repeater > div li.day"),t=n.length,n.each(function(e,t){var n=s(t).find("span.select2-container:first-of-type .select2-selection__rendered").attr("title"),t=s(t).find("span.select2-container:nth-of-type(2) .select2-selection__rendered").attr("title");a.push({from:n,to:t})})),s(e).each(function(){var n=s(this).find("a").attr("aria-controls");s("#"+n).find(".work-hours-repeater > div li.day").length;s("#"+n).find(".work-hours-type > div input[value="+i+"]").click(),s("#"+n).find(".work-hours-repeater > div li.day").remove();for(var e=1;e<=t;e++)s("#"+n).find(".work-hours-repeater > input[type=button].add-row-button").click();a.forEach(function(e,t){t+=1;s("#".concat(n," .work-hours-repeater > div li.day:nth-of-type(").concat(t,")")).find("span.select2-container:nth-of-type(1) .select2-selection__rendered").attr("title",e.from).html(e.from),s("#".concat(n," .work-hours-repeater > div li.day:nth-of-type(").concat(t,")")).find("select.select2-hidden-accessible:nth-of-type(1)").val(moment(e.from,"h:mm a").format("HH:mm")),s("#".concat(n," .work-hours-repeater > div li.day:nth-of-type(").concat(t,")")).find("span.select2-container:nth-of-type(2) .select2-selection__rendered").attr("title",e.to).html(e.to),s("#".concat(n," .work-hours-repeater > div li.day:nth-of-type(").concat(t,")")).find("select.select2-hidden-accessible:nth-of-type(2)").val(moment(e.to,"h:mm a").format("HH:mm"))})})}(l),t+=" "+d}u=[],c.find(".copy-hours-wrapper .md-checkbox input").prop("checked",!1),s(".c27-submit-listing-form").length?new MyListing.Dialog({message:p+" "+t}):s(".ml-admin-listing-form").length&&alert(p+" "+t),s(".copy-hours-wrapper").addClass("hidden")}else s(".c27-submit-listing-form").length?new MyListing.Dialog({message:f}):s(".ml-admin-listing-form").length&&alert(f)}),c.find(".days .nav-tabs > li").on("click",function(){var e=s(this).index()+2;s(".copy-hours-wrapper").addClass("hidden").find(".md-checkbox:nth-child("+e+")").addClass("hidden").siblings().removeClass("hidden"),c.find(".copy-hours-wrapper .md-checkbox input").prop("checked",!1)}))}),jQuery(function(v){v(".event-picker").each(function(){var t=v(this),e=t.data("dates"),o=t.data("key"),n=t.data("limit"),r="no"!==t.data("timepicker"),y=t.data("l10n"),d=t.find(".dates-list"),i=t.find(".date-add-new"),a=e.length+1,l=t.find(".datetpl").text();function s(){var e=t.find(".single-date").length;n<=e?i.hide():i.show(),e<1&&c()}function c(){p({start:"",end:"",repeat:!1,frequency:2,unit:"weeks",until:moment().add(1,"years").locale("en").format("YYYY-MM-DD"),index:a++})}function p(e){var t=v(l.replace(/{date}/g,o+"["+e.index+"]")),c=t.find(".is-recurring input"),p=t.find(".date-start input"),f=t.find(".date-end input"),u=t.find(".repeat-frequency input"),h=t.find(".repeat-unit"),m=t.find(".repeat-message"),g=t.find(".repeat-end input");function n(){if(c.prop("checked")){var e=p.val(),t=f.val(),n=g.val(),i=parseInt(u.val(),10),a=h.find("input:checked").val();if(e.length&&t.length&&n.length&&i){e=moment(e),t=moment(t),(n=moment(n)).set({hour:23,minute:59,second:59}),"weeks"===a&&(a="days",i*=7),"years"===a&&(a="months",i*=12);for(var n=Math.abs(e.diff(n,a)),o=Math.floor(n/i),r=[],d=1;d<Math.min(o+1,6);d++){var l=e.clone().add(i*d,a),s=t.clone().add(i*d,a);r.push("".concat(l.format(CASE27.l10n.datepicker.format)," - ").concat(s.format(CASE27.l10n.datepicker.format)))}n=y.next_five.replace("%d",o);o<1?n=y.no_recurrences:o<5&&(n=y.next_recurrences),m.show().html("<span>".concat(n,'</span><ul class="no-list-style"><li>').concat(r.join("</li><li>"),"</li></ul>"))}else m.hide()}}p.val(e.start),f.val(e.end),c.prop("checked",e.repeat),u.val(e.frequency),h.find('input[value="'.concat(e.unit,'"]')).prop("checked",!0),g.val(e.until),e.repeat&&t.find(".recurrence").addClass("is-open"),c.on("change",function(){n(),v(this).prop("checked")?t.find(".recurrence").addClass("is-open"):t.find(".recurrence").removeClass("is-open")});new MyListing.Datepicker(p,{timepicker:r});var i=new MyListing.Datepicker(f,{timepicker:r}),a=new MyListing.Datepicker(g);e.start&&t.find(".date-start").removeClass("date-empty"),e.end&&t.find(".date-end").removeClass("date-empty"),p.on("datepicker:change",function(e){i.setMinDate(moment(e.detail.value)),c.length&&a.setMinDate(moment(e.detail.value)),n(),e.detail.value?t.find(".date-start").removeClass("date-empty"):t.find(".date-start").addClass("date-empty")}),f.on("datepicker:change",function(e){n(),e.detail.value?t.find(".date-end").removeClass("date-empty"):t.find(".date-end").addClass("date-empty")}),g.on("datepicker:change",n),u.on("input",n),h.find("input").on("change",n),n(),d.append(t)}e.forEach(function(e,t){p({start:e.start,end:e.end,repeat:e.repeat,frequency:e.repeat?e.frequency:2,unit:e.repeat?e.unit:"weeks",until:e.repeat?e.until:moment(e.start).add(1,"years").locale("en").format("YYYY-MM-DD"),index:t})}),e.length||c(),i.click(function(e){e.preventDefault(),p({start:"",end:"",repeat:!1,frequency:2,unit:"weeks",until:moment().add(1,"years").locale("en").format("YYYY-MM-DD"),index:a++}),s()}),v(this).on("click",".remove-date",function(e){e.preventDefault(),v(this).parents(".single-date").remove(),s()}),s()})}),jQuery(function(o){o(".listing-form-field .file-upload-field").on("click",".remove-uploaded-file",function(e){e.preventDefault(),o(this).parents(".uploaded-file").remove()}),o(".listing-form-field .file-upload-field").on("dblclick",".uploaded-file",function(e){e.preventDefault(),"hidden"===o(this).find("input").attr("type")?o(this).find("input").attr("type","text"):o(this).find("input").attr("type","hidden")}),o(".listing-form-field .listing-file-upload-input").click(function(e){e.preventDefault();var t,n=o(this).parents(".file-upload-field").find(".job-manager-uploaded-files"),i=o(this).data("name"),a="yes"===o(this).data("multiple");o(this).data("file_frame")?o(this).data("file_frame").open():((t=wp.media.frames.file_frame=wp.media({multiple:!0})).open(),o(this).data("file_frame",t),t.on("select",function(){t.state().get("selection").each(function(e){var t;"image"===(e=e.toJSON()).type?(t=o('\n\t\t<div class="uploaded-file">\n\t\t\t<span class="uploaded-image-preview"></span>\n\t\t\t<a class="remove-uploaded-file"><i class="mi delete"></i></a>\n\t\t\t<input type="hidden" class="input-text">\n\t\t</div>')).find(".uploaded-image-preview").css("background-image",'url("'+e.url+'")'):(t=o('\n\t\t<div class="uploaded-file">\n\t\t\t<span class="uploaded-file-preview">\n\t\t\t\t<i class="mi insert_drive_file uploaded-file-icon"></i>\n\t\t\t\t<code></code>\n\t\t\t</span>\n\t\t\t<a class="remove-uploaded-file"><i class="mi delete"></i></a>\n\t\t\t<input type="hidden" class="input-text">\n\t\t</div>')).find("code").text(e.filename),t.find("input").attr("name","current_"+i).val(e.encoded_guid),a?n.append(t):n.html(t)})}))})}),jQuery(function(m){MyListing.Maps&&MyListing.Maps.loaded&&(m(".repeater-custom").each(function(e,t){var u=parseInt(m(t).data("max"),10),h=m(t).find(".add-location");m(t).repeater({initEmpty:!0,ready:function(e){},hide:function(e){var n=m(this).find(".location-field-wrapper").data("index");MyListing.Maps.instances;MyListing.Maps.instances.forEach(function(e,t){e.id==n&&delete MyListing.Maps.instances[t]}),MyListing.Maps.instances=MyListing.Maps.instances.filter(function(e){return null!==e}),e(),m("div[data-repeater-item] > .location-field-wrapper").length>=u?h.hide():h.show()},show:function(){var e=this,t=(m(e).show(),m("div[data-repeater-item] > .location-field-wrapper")),n=m(e).find(".delete-repeater-item"),n=(t.length>=u?h.hide():h.show(),1==u?n.hide():n.show(),t.eq(-2).length?(n=t.eq(-2).data("index"),m(e).find(".location-field-wrapper").attr("data-index",n+1),m(e).find(".location-picker-custom-map").attr("id",n+1),m(e).find('.lock-pin input[type="checkbox"]').attr("id","location__lock_pin_"+n+1),m(e).find(".locked").attr("for","location__lock_pin_"+n+1),m(e).find(".unlocked").attr("for","location__lock_pin_"+n+1)):(m(e).find(".location-field-wrapper").attr("data-index",t.length-1),m(e).find(".location-picker-custom-map").attr("id",t.length-1),0<t.length-1&&(m(e).find('.lock-pin input[type="checkbox"]').attr("id","location__lock_pin_"+t.length-1),m(e).find(".locked").attr("for","location__lock_pin_"+t.length-1),m(e).find(".unlocked").attr("for","location__lock_pin_"+t.length-1))),new MyListing.Maps.Map(m(e).find(".c27-custom-map:not(.delay-init)").get(0)),new MyListing.Maps.Autocomplete(m(e).find(".address-field").get(0)),m(e).find(".location-field-wrapper")),t=m(e).find(".location-picker-custom-map").attr("id"),i=MyListing.Maps.getInstance(t).instance,a=(m(e).find(".cts-custom-get-location").on("click",function(e){e.preventDefault();var t=jQuery(jQuery(this).parents(".repeater-item"));t.find(".cts-custom-get-location").length&&(i&&MyListing.Geocoder.setMap(i.instance),MyListing.Geocoder.getUserLocation({receivedAddress:function(e){if(t.find(".address-field").val(e.address),t.find(".address-field").data("autocomplete"))return t.find(".address-field").data("autocomplete").fireChangeEvent(e)}}))}),n.data("options")),o=n.find(".location-coords"),r=n.find(".latitude-input"),d=n.find(".longitude-input"),l=n.find(".address-field"),s=n.find('.lock-pin input[type="checkbox"]'),t=n.find(".enter-coordinates-toggle > span"),c=new MyListing.Maps.Marker({position:f(),map:i,template:{type:"traditional"}});function p(){var e=f();c.setPosition(e),i.panTo(e),""!==r.val().trim()&&""!==d.val().trim()&&(r.val(e.getLatitude()),d.val(e.getLongitude()))}function f(){return r.val().trim()&&d.val().trim()?new MyListing.Maps.LatLng(r.val(),d.val()):new MyListing.Maps.LatLng(a["default-lat"],a["default-lng"])}i.addListener("click",function(e){s.prop("checked")||(e=i.getClickPosition(e),c.setPosition(e),r.val(e.getLatitude()),d.val(e.getLongitude()),MyListing.Geocoder.geocode(e.toGeocoderFormat(),function(e){e&&l.val(e.address)}))}),l.on("autocomplete:change",function(e){var t;!s.prop("checked")&&e.detail.place&&e.detail.place.latitude&&e.detail.place.longitude&&(t=new MyListing.Maps.LatLng(e.detail.place.latitude,e.detail.place.longitude),c.setPosition(t),r.val(e.detail.place.latitude),d.val(e.detail.place.longitude),i.panTo(t))}),i.addListenerOnce("free-map"===CASE27.map_provider?"moveend":"idle",function(e){i.setZoom(a["default-zoom"])}),s.on("change",function(e){i.trigger("resize"),i.setCenter(f())}).change(),t.click(function(e){o.toggleClass("hide")}),r.blur(p),d.blur(p)}}).setList(m(t).data("list"))}),jQuery(".field-type-location .address-field").each(function(e,t){new MyListing.Maps.Autocomplete(t)}),jQuery(".cts-custom-get-location").each(function(e,t){jQuery(t).on("click",function(e){e.preventDefault();var t=jQuery(jQuery(this).parent(".repeater-item"));t.find(".cts-custom-get-location").length&&((e=MyListing.Maps.getInstance(jQuery(this)))&&MyListing.Geocoder.setMap(e.instance),MyListing.Geocoder.getUserLocation({receivedAddress:function(e){if(t.find(".cts-custom-get-location").val(e.address),t.find(".cts-custom-get-location").data("autocomplete"))return t.find(".cts-custom-get-location").data("autocomplete").fireChangeEvent(e)}}))})}))}),jQuery(function(t){t(".c27-work-hours .bl-tabs-menu a").on("click",function(e){e.preventDefault();e=t(this).attr("href");t(".c27-work-hours .tab-pane").removeClass("active"),t(".c27-work-hours .tab-pane"+e).addClass("active"),t(this).parent().addClass("active").siblings().removeClass("active")})})});
