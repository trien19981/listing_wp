!function(e){"function"==typeof define&&define.amd?define("explore",e):e()}(function(){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Vue.component("results-header",{data:function(){return{currentPage:0,totalPages:0,hasPrevPage:!1,hasNextPage:!1,foundPosts:null,resultCountText:"",target:null}},mounted:function(){var i=this;this.$nextTick(function(){i.$root.$on("update-results",function(e){var t=i.$root.activeType;i.target=t.filters,i.resultCountText=e.showing,i.totalPages=parseInt(e.max_num_pages,10),i.currentPage=parseInt(i.target.page,10),i.hasPrevPage=0<=i.currentPage-1,i.hasNextPage=i.currentPage+1<i.totalPages,i.foundPosts=parseInt(e.found_posts,10)})})},methods:{getNextPage:function(){this.target.page=this.currentPage+1,this.target.preserve_page=!0,this.$root._getListings("next-page")},getPrevPage:function(e){this.target.page=this.currentPage-1,this.target.preserve_page=!0,this.$root._getListings("previous-page")}}}),Vue.component("load-more-results",{data:function(){return{currentPage:0,totalPages:0,canLoadMore:!1,target:null,foundPosts:null,showing:0}},mounted:function(){var i=this;this.$nextTick(function(){i.$root.$on("update-results",function(e){var t=i.$root.activeType;i.target=t.filters,i.totalPages=parseInt(e.max_num_pages,10),i.currentPage=parseInt(i.target.page,10)||0,i.canLoadMore=i.currentPage+1<i.totalPages,i.foundPosts=parseInt(e.found_posts,10),i.showing=Math.min((i.currentPage+1)*e.posts_per_page,i.foundPosts)})})},methods:{loadMore:function(){this.canLoadMore&&(this.target.page=this.currentPage+1,this.target.preserve_page=!0,this.$root._getListings("load-more"))}}}),Vue.component("wp-search-filter",{props:{listingType:String,filterKey:String,location:String,label:String},mounted:function(){var e=this;this.$nextTick(function(){e.$root.$on("reset-filters:"+e.listingType,function(){e.filters[e.filterKey]=""})})},methods:{updateInput:function(){this.filters[this.filterKey]=this.$refs.input.value,this.$emit("input",this.$refs.input.value,{filterType:this.$options.name,filterKey:this.filterKey,location:this.location})}},computed:{filters:function(){return this.$root.types[this.listingType].filters}}}),Vue.component("text-filter",{props:{listingType:String,filterKey:String,location:String,label:String},mounted:function(){var e=this;this.$nextTick(function(){e.$root.$on("reset-filters:"+e.listingType,function(){e.filters[e.filterKey]=""})})},methods:{updateInput:function(){this.filters[this.filterKey]=this.$refs.input.value,this.$emit("input",this.$refs.input.value,{filterType:this.$options.name,filterKey:this.filterKey,location:this.location})}},computed:{filters:function(){return this.$root.types[this.listingType].filters}}}),Vue.component("location-filter",{props:{listingType:String,filterKey:String,location:String,label:String},data:function(){return{latitudeKey:"lat",longitudeKey:"lng"}},created:function(){this.$root.$on("request-location:"+this.listingType,this.requestALocation)},mounted:function(){var e=this;this.$nextTick(function(){MyListing.Maps&&MyListing.Maps.loaded?new MyListing.Maps.Autocomplete(e.$refs.input):jQuery(document).on("maps:loaded",function(){new MyListing.Maps.Autocomplete(e.$refs.input)}),jQuery(e.$root.$el).find(".finder-search").on("scroll",MyListing.Helpers.debounce(function(e){jQuery(".pac-container").css("display","none"),jQuery(".cts-autocomplete-dropdown").removeClass("active")},100,{leading:!0,trailing:!1})),e.$root.$on("reset-filters:"+e.listingType,function(){e.filters[e.filterKey]="",e.filters[e.latitudeKey]=!1,e.filters[e.longitudeKey]=!1})})},methods:{handleAutocomplete:function(t){var i=this,e=t.detail.place;t.target.value.length?e.address&&e.latitude&&e.longitude?this.updateInput(e):MyListing.Geocoder.geocode(t.target.value,function(e){e&&(e.address=t.target.value,i.updateInput(e))}):this.updateInput({address:"",latitude:!1,longitude:!1})},updateInput:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],i=2<arguments.length&&void 0!==arguments[2]&&arguments[2];this.filters[this.filterKey]=e.address,this.filters[this.latitudeKey]=e.latitude,this.filters[this.longitudeKey]=e.longitude,this.$emit("input",this.filters[this.filterKey],{filterType:this.$options.name,filterKey:this.filterKey,location:this.location,shouldDebounce:t,forceGet:i})},updateWithUserLocation:MyListing.Helpers.debounce(function(){var t=this;MyListing.Geocoder.getUserLocation({receivedAddress:function(e){return t.updateInput(e)},geolocationFailed:function(){new MyListing.Dialog({message:CASE27.l10n.geolocation_failed})}})},1e3,{leading:!0,trailing:!1}),requestALocation:function(){var t,i,s=this,e=this.currentLocation;if(e.address&&e.latitude&&e.longitude)return this.updateInput(e,!1,!0);!e.address||e.latitude||e.longitude?(i=new MyListing.Dialog({message:CASE27.l10n.nearby_listings_retrieving_location,timeout:!1,dismissable:!1,spinner:!0}),MyListing.Geocoder.getUserLocation({receivedAddress:function(e){s.updateInput(e,!0,!0),i.refresh({message:CASE27.l10n.nearby_listings_searching,timeout:2e3,spinner:!0,dismissable:!1})},geolocationFailed:function(){i.refresh({message:CASE27.l10n.nearby_listings_location_required,timeout:4e3,dismissable:!0,spinner:!1}),s.updateInput(s.currentLocation,!0,!0),jQuery(s.$refs.input).focus().one("input",function(){return i.hide()})}})):void 0!==(t=CASE27_Explore_Settings.Cache).defaultLocation?this.updateInput(t.defaultLocation,!0,!0):MyListing.Geocoder.geocode(e.address,function(e){t.defaultLocation={address:e?e.address:"",latitude:!!e&&e.latitude,longitude:!!e&&e.longitude},s.updateInput(t.defaultLocation,!0,!0)})}},computed:{currentLocation:function(){return{address:this.filters[this.filterKey]||"",latitude:this.filters[this.latitudeKey],longitude:this.filters[this.longitudeKey]}},filters:function(){return this.$root.types[this.listingType].filters}}}),Vue.component("proximity-filter",{props:{listingType:String,filterKey:String,location:String,label:String,units:String,min:Number,max:Number,step:Number,default:Number},data:function(){return{locked:!1}},mounted:function(){var e=this;this.$nextTick(function(){jQuery(e.$refs.slider).slider({range:"min",min:e.min||0,max:e.max,step:e.step,slide:e.updateInput,value:e.filters[e.filterKey]?parseFloat(e.filters[e.filterKey]):e.default}),e.$root.$on("reset-filters:"+e.listingType,function(){e.filters[e.filterKey]=e.default,e.updateUI()})})},methods:{updateInput:function(e,t){this.locked||(this.filters[this.filterKey]=t.value,this.$emit("input",t.value,{filterType:this.$options.name,filterKey:this.filterKey,location:this.location}))},updateUI:function(){this.locked=!0;var e=this.filters[this.filterKey]?parseFloat(this.filters[this.filterKey]):this.default;jQuery(this.$refs.slider).slider("value",e),this.locked=!1}},computed:{displayValue:function(){var e=isNaN(parseFloat(this.filters[this.filterKey]))?this.filters[this.filterKey]:parseFloat(this.filters[this.filterKey]).toLocaleString();return"".concat(this.label," ").concat(e).concat(this.units)},filters:function(){return this.$root.types[this.listingType].filters}}}),Vue.component("date-filter",{props:{listingType:String,filterKey:String,location:String,label:String,type:String,l10n:Object},data:function(){return{startDate:"",endDate:"",dateFormat:"YYYY-MM-DD",locked:!1,startPicker:null,endPicker:null}},created:function(){var e=this.filters[this.filterKey].split(".."),t=moment(e[0]||""),e=moment(e[1]||"");this.startDate=t.isValid()?t.clone().locale("en").format(this.dateFormat):"",this.endDate=e.isValid()?e.clone().locale("en").format(this.dateFormat):""},mounted:function(){var t=this;this.$nextTick(function(){t.startPicker=new MyListing.Datepicker(t.$refs.startpicker),t.endPicker=new MyListing.Datepicker(t.$refs.endpicker),jQuery(t.$root.$el).find(".finder-search").on("scroll",MyListing.Helpers.debounce(function(e){t.startPicker.drp.hide(),t.endPicker.drp&&t.endPicker.drp.hide()},100,{leading:!0,trailing:!1})),t.$root.$on("reset-filters:"+t.listingType,function(){t.locked=!0,t.startDate=t.endDate="",t.startPicker.setValue(moment("")),t.endPicker.setValue(moment("")),t.locked=!1})})},methods:{updateInput:function(){var e;e="exact"===this.type?this.startDate:this.startDate||this.endDate?"".concat(this.startDate,"..").concat(this.endDate):"",this.filters[this.filterKey]=e,this.locked||this.$emit("input",e,{filterType:this.$options.name,filterKey:this.filterKey,location:this.location,shouldDebounce:!1})}},computed:{filters:function(){return this.$root.types[this.listingType].filters}}}),Vue.component("date-year-filter",{props:{listingType:String,filterKey:String,location:String,choices:Array,label:String,type:String,l10n:Object},data:function(){return{startDate:"",endDate:"",dateFormat:"YYYY",locked:!1}},created:function(){var e=this.filters[this.filterKey].split(".."),t=moment(e[0]||""),e=moment(e[1]||"");this.startDate=t.isValid()?t.clone().locale("en").format(this.dateFormat):"",this.endDate=e.isValid()?e.clone().locale("en").format(this.dateFormat):""},mounted:function(){var e=this;this.$nextTick(function(){new MyListing.CustomSelect(e.$refs.startpicker),new MyListing.CustomSelect(e.$refs.endpicker),e.$root.$on("reset-filters:"+e.listingType,function(){e.locked=!0,e.startDate=e.endDate="",jQuery(e.$refs.startpicker).val("").trigger("change").trigger("select2:close"),jQuery(e.$refs.endpicker).val("").trigger("change").trigger("select2:close"),e.locked=!1})})},methods:{updateInput:function(){var e;e="exact"===this.type?this.startDate:this.startDate||this.endDate?"".concat(this.startDate,"..").concat(this.endDate):"",this.filters[this.filterKey]=e,this.locked||this.$emit("input",e,{filterType:this.$options.name,filterKey:this.filterKey,location:this.location,shouldDebounce:!1})}},computed:{filters:function(){return this.$root.types[this.listingType].filters}}}),Vue.component("recurring-date-filter",{props:{listingType:String,filterKey:String,location:String,label:String,presets:Array,enableDatepicker:Boolean,enableTimepicker:Boolean,l10n:Object},data:function(){return{selected:"@custom",startDate:"",endDate:"",dateFormat:this.enableTimepicker?"YYYY-MM-DD HH:mm":"YYYY-MM-DD",locked:!1,startPicker:null,endPicker:null}},created:function(){var e,t,i=this.filters[this.filterKey];this.enableDatepicker&&-1!==i.indexOf("..")?(t=moment(i.split("..")[0]),e=moment(i.split("..")[1]),this.selected="@custom",this.startDate=t.isValid()?t.clone().locale("en").format(this.dateFormat):"",this.endDate=e.isValid()?e.clone().locale("en").format(this.dateFormat):""):(t=this.presets.find(function(e){return e.key===i}),this.selected=t?t.key:this.presets.length?this.presets[0].key:"@custom")},mounted:function(){var t=this;this.$nextTick(function(){var e=t.enableTimepicker;t.startPicker=new MyListing.Datepicker(t.$refs.start,{timepicker:e}),t.endPicker=new MyListing.Datepicker(t.$refs.end,{timepicker:e}),t.endPicker.do(function(e){return e.drp.minDate=moment(t.startDate)}),jQuery(t.$root.$el).find(".finder-search").on("scroll",MyListing.Helpers.debounce(function(e){t.startPicker.drp.hide(),t.endPicker.drp.hide()},100,{leading:!0,trailing:!1})),new MyListing.CustomSelect(t.$refs.select),t.$root.$on("reset-filters:"+t.listingType,function(){t.locked=!0,t.selected=t.presets.length?t.presets[0].key:"@custom",t.startPicker.setValue(moment("")),t.endPicker.setValue(moment("")),t.locked=!1})})},methods:{setPreset:function(e){this.selected!==e&&(this.selected=e,this.updateInput())},updateInput:function(){var e,t=this;"@custom"===this.selected&&this.enableDatepicker?(this.endPicker.do(function(e){return e.drp.minDate=moment(t.startDate)}),this.startDate||(this.endDate="",this.endPicker.do(function(e){e.value=moment(""),e.updateInputValues()})),e=this.startDate?"".concat(this.startDate,"..").concat(this.endDate):""):"@custom"!==this.selected&&(e=this.presets.length&&this.presets[0].key===this.selected?"":this.selected),this.filters[this.filterKey]=e,this.locked||this.$emit("input",e,{filterType:this.$options.name,filterKey:this.filterKey,location:this.location,shouldDebounce:!1})}},computed:{filters:function(){return this.$root.types[this.listingType].filters}}}),Vue.component("range-filter",{props:{listingType:String,filterKey:String,location:String,label:String,value:String,type:String,prefix:String,suffix:String,behavior:String,min:Number,max:Number,step:Number,formatValue:Boolean},data:function(){return{defaultValue:"range"===this.type?"".concat(this.min,"..").concat(this.max):"upper"===this.behavior?this.min:this.max,locked:!1,debounceUIUpdate:MyListing.Helpers.debounce(this.updateUI,200)}},mounted:function(){var i=this;this.$nextTick(function(){var e,t={range:"single"!==i.type||"min",min:i.min,max:i.max,step:i.step,slide:i.updateInput};"single"===i.type&&(t.value=i.value?parseFloat(i.value):"upper"===i.behavior?i.min:i.max,"upper"===i.behavior)&&(t.classes={"ui-slider":"reverse-dir"}),"range"===i.type&&(e=i.value.split(".."),t.values=[e[0]?parseFloat(e[0]):i.min,e[1]?parseFloat(e[1]):i.max]),jQuery(i.$refs.slider).slider(t),i.$root.$on("reset-filters:"+i.listingType,function(){i.filters[i.filterKey]="",i.updateUI()})})},methods:{updateInput:function(e,t){this.locked||("single"===this.type?this.step+t.value>this.max&&(this.filters[this.filterKey]=t.value=this.max,this.updateUI()):this.step+t.values[1]>this.max&&(t.values[1]=this.max,this.filters[this.filterKey]="".concat(t.values[0],"..").concat(t.values[1]),this.updateUI()),t=(t="single"===this.type?t.value:"".concat(t.values[0],"..").concat(t.values[1]))!==this.defaultValue?t:"",this.$set(this.filters,this.filterKey,t),this.$emit("input",t,{filterType:this.$options.name,filterKey:this.filterKey,location:this.location}))},updateUI:function(){this.locked=!0;var e=this.filters[this.filterKey]||this.defaultValue;"single"===this.type?jQuery(this.$refs.slider).slider("value",e):jQuery(this.$refs.slider).slider("values",e.split("..")),this.locked=!1}},computed:{displayValue:function(){var e,t=this.filters[this.filterKey]||this.defaultValue;return("single"===this.type?(t=!isNaN(parseFloat(t))&&this.formatValue?parseFloat(t).toLocaleString():t,"".concat(this.prefix).concat(t)):(t=t.split(".."),e=!isNaN(parseFloat(t[0]))&&this.formatValue?parseFloat(t[0]).toLocaleString():t[0],t=!isNaN(parseFloat(t[1]))&&this.formatValue?parseFloat(t[1]).toLocaleString():t[1],jQuery("body").hasClass("rtl")?"".concat(this.prefix).concat(t).concat(this.suffix," — ").concat(this.prefix).concat(e):"".concat(this.prefix).concat(e).concat(this.suffix," — ").concat(this.prefix).concat(t))).concat(this.suffix)},targetFilter:function(){return this.filters[this.filterKey]},filters:function(){return this.$root.types[this.listingType].filters}},watch:{targetFilter:function(){this.debounceUIUpdate()}}}),Vue.component("dropdown-filter",{props:{listingType:String,filterKey:String,location:String,label:String,multiple:Boolean,choices:Array},data:function(){return{selected:this.multiple?[]:""}},created:function(){this.selected=this.multiple?this.filters[this.filterKey].split(","):this.filters[this.filterKey]},mounted:function(){var e=this;this.$nextTick(function(){new MyListing.CustomSelect(e.$refs.select),e.$root.$on("reset-filters:"+e.listingType,function(){e.selected=e.multiple?[]:"",e.filters[e.filterKey]="",jQuery(e.$refs.select).val(e.selected).trigger("change").trigger("select2:close")})})},methods:{handleChange:function(e){this.selected=this.multiple?Array.isArray(e.detail.value)?e.detail.value:[]:"string"==typeof e.detail.value?e.detail.value:"",this.updateInput()},updateInput:function(){var e=this.multiple?this.selected.filter(Boolean).join(","):this.selected;this.filters[this.filterKey]=e,this.$emit("input",e,{filterType:this.$options.name,filterKey:this.filterKey,location:this.location})},isSelected:function(e){return this.multiple?this.selected.includes(e):e===this.selected}},computed:{filters:function(){return this.$root.types[this.listingType].filters}}}),Vue.component("dropdown-terms-filter",{props:{listingType:String,filterKey:String,location:String,ajaxParams:String,label:String,preSelected:Array},data:function(){return{selected:[]}},created:function(){this.selected=this.filters[this.filterKey].split(",")},mounted:function(){var e=this;this.$nextTick(function(){new MyListing.CustomSelect(e.$refs.select),e.$root.$on("reset-filters:"+e.listingType,function(){e.selected=e.filters[e.filterKey]=[],jQuery(e.$refs.select).val([]).trigger("change").trigger("select2:close")})})},methods:{handleChange:function(e){this.selected=Array.isArray(e.detail.value)?e.detail.value:[],this.updateInput()},updateInput:function(){var e=this.selected.join(",");this.filters[this.filterKey]=e,this.$emit("input",e,{filterType:this.$options.name,filterKey:this.filterKey,location:this.location})}},computed:{filters:function(){return this.$root.types[this.listingType].filters}}}),Vue.component("dropdown-hierarchy-filter",{props:{listingType:String,filterKey:String,location:String,label:String,ajaxParams:String,preSelected:String},data:function(){return{selected:""}},created:function(){this.selected=this.filters[this.filterKey]},mounted:function(){var e=this;this.$nextTick(function(){new MyListing.TermHierarchy(e.$refs.input),e.$root.$on("reset-filters:"+e.listingType,function(){e.selected=e.filters[e.filterKey]="",jQuery(e.$el).find(".term-select-0 select").val("").trigger("change").trigger("select2:close")})})},methods:{handleChange:function(e){this.selected="string"==typeof e.detail.value?e.detail.value:"",this.updateInput()},updateInput:function(){this.filters[this.filterKey]=this.selected,this.$emit("input",this.selected,{filterType:this.$options.name,filterKey:this.filterKey,location:this.location})}},computed:{filters:function(){return this.$root.types[this.listingType].filters}}}),Vue.component("checkboxes-filter",{props:{listingType:String,filterKey:String,location:String,label:String,multiple:Boolean,choices:Array},data:function(){return{selected:this.multiple?[]:""}},created:function(){this.selected=this.multiple?this.filters[this.filterKey].split(","):this.filters[this.filterKey]},mounted:function(){var e=this;this.$nextTick(function(){e.$refs.select&&new MyListing.CustomSelect(e.$refs.select),e.$root.$on("reset-filters:"+e.listingType,function(){e.selected=e.multiple?[]:"",e.filters[e.filterKey]=""})})},methods:{updateInput:function(){var e=this.multiple?this.selected.filter(Boolean).join(","):this.selected;this.filters[this.filterKey]=e,this.$emit("input",e,{filterType:this.$options.name,filterKey:this.filterKey,location:this.location,shouldDebounce:!this.$refs.workHourRanges})}},computed:{filters:function(){return this.$root.types[this.listingType].filters},filterId:function(){return"fid:".concat(this.listingType,"-").concat(this.filterKey,"-").concat(this._uid)}}}),Vue.component("related-listing-filter",{props:{listingType:String,filterKey:String,location:String,ajaxParams:String,label:String,preSelected:Array,multiple:Boolean},data:function(){return{selected:this.multiple?[]:""}},created:function(){this.selected=this.multiple?this.filters[this.filterKey].split(","):this.filters[this.filterKey]},mounted:function(){var e=this;this.$nextTick(function(){e.$refs.select.dataset.mylistingAjax=!0,e.$refs.select.dataset.mylistingAjaxUrl="mylisting_list_posts",e.$refs.select.dataset.mylistingAjaxParams=e.ajaxParams,new MyListing.CustomSelect(e.$refs.select),e.$root.$on("reset-filters:"+e.listingType,function(){e.selected=e.filters[e.filterKey]=e.multiple?[]:"",jQuery(e.$refs.select).val(e.selected).trigger("change").trigger("select2:close")})})},methods:{handleChange:function(e){this.selected=this.multiple?Array.isArray(e.detail.value)?e.detail.value:[]:"string"==typeof e.detail.value?e.detail.value:"",this.updateInput()},updateInput:function(){var e=this.multiple?this.selected.join(","):this.selected;this.filters[this.filterKey]=e,this.$emit("input",e,{filterType:this.$options.name,filterKey:this.filterKey,location:this.location})}},computed:{filters:function(){return this.$root.types[this.listingType].filters}}}),Vue.component("order-filter",{props:{listingType:String,filterKey:String,choices:Array,location:String,label:String},data:function(){return{locked:!1}},mounted:function(){var i=this;this.$nextTick(function(){new MyListing.CustomSelect(i.$refs.select);var t=i.filters[i.filterKey];t&&i.choices.find(function(e){return e.key===t})||!i.choices.length||(i.filters[i.filterKey]=i.choices[0].key,i.updateUI()),i.$root.$on("reset-filters:"+i.listingType,function(){var e=i.choices.length?i.choices[0].key:null;i.filters[i.filterKey]=e,i.updateUI()})})},methods:{updateInput:function(){this.locked||(this.filters[this.filterKey]=this.$refs.select.value,this.hasNote(this.filters[this.filterKey],"has-proximity-clause")?this.$root.$emit("request-location:"+this.listingType):this.$emit("input",this.$refs.select.value,{filterType:this.$options.name,filterKey:this.filterKey,location:this.location,shouldDebounce:!1}))},updateUI:function(){this.locked=!0,jQuery(this.$refs.select).val(this.filters[this.filterKey]).trigger("change").trigger("select2:close"),this.locked=!1},hasNote:function(t,e){return!(!(t=this.choices.find(function(e){return e.key===t}))||!t.notes)&&-1!==t.notes.indexOf(e)}},computed:{wrapperClasses:function(){var e=this.currentChoice;return e&&e.notes?e.notes:[]},currentChoice:function(){var t=this;return this.choices.find(function(e){return e.key===t.filters.sort})},locationDetails:function(){return this.$root.hasValidLocation(this.listingType)?this.filters.search_location:CASE27.l10n.nearby_listings_location_required},filters:function(){return this.$root.types[this.listingType].filters}},watch:{"filters.sort":function(e){this.updateUI()}}}),MyListing.Explore_Init=function(){var e=document.querySelector(".cts-explore");e&&!e.dataset.inited&&(e.dataset.inited=!0,MyListing.Handlers.Compare_Button=function(e,t){var i,s;e.preventDefault(),MyListing.Explore&&(e=(t=jQuery(t)).parents(".lf-item-container"),i=parseInt(e.data("id").replace("listing-id-",""),10),e.hasClass("compare-chosen")?(-1<(s=MyListing.Explore.compare.indexOf(i))&&MyListing.Explore.compare.splice(s,1),e.removeClass("compare-chosen"),t.find("i").removeClass("remove").addClass("add")):MyListing.Explore.compare.includes(i)||(MyListing.Explore.compare.push(i),e.addClass("compare-chosen"),t.find("i").removeClass("add").addClass("remove")))},MyListing.Explore=new Vue({el:e,data:{activeType:!1,types:CASE27_Explore_Settings.ListingTypes,template:CASE27_Explore_Settings.Template,loading:!1,last_request:null,found_posts:null,pagination:CASE27_Explore_Settings.Pagination,infinite_scroll:CASE27_Explore_Settings.InfiniteScroll,isotope:!CASE27_Explore_Settings.DisableIsotope,state:{mobileTab:CASE27_Explore_Settings.ActiveMobileTab},isMobile:window.matchMedia("screen and (max-width: 1200px)").matches,map:!1,mapExpanded:!1,mapProvider:CASE27.map_provider,dragSearch:!1,proximity_units:jQuery(".explore-filter.proximity-filter").data("units"),circleMarker:null,circle:null,compare:[],suspendDragSearch:!1,baseUrl:CASE27_Explore_Settings.ExplorePage||window.location.href.replace(window.location.search,"")},beforeMount:function(){function e(e){var t=(i.isMobile?jQuery(document):jQuery(".finder-listings")).scrollTop();0<t&&window.history.replaceState(null,null,i.updateUrlParameter(window.location.href,"sp",Math.round(t)))}var i=this;window.matchMedia("screen and (max-width: 1200px)").addListener(function(e){return i.isMobile=e.matches}),this.setType(CASE27_Explore_Settings.ActiveListingType),this.isMobile&&Object.keys(this.types).forEach(function(e){var e=this.types[e],t=e.taxonomies[e.tab];t&&t.activeTermId||(e.tab="search-form")}.bind(this));window.addEventListener("beforeunload",e),window.addEventListener("unload",e),this.jQueryReady()},mounted:function(){(this.isMobile||"explore-no-map"===this.template||"explore-classic"===this.template)&&"load-more"===this.pagination&&this.infinite_scroll&&window.addEventListener("scroll",this.infiniteScrollMobile)},beforeDestroy:function(){window.removeEventListener("scroll",this.infiniteScrollMobile)},methods:{setType:function(e){this.types[e]&&(this.activeType=this.types[e])},getListings:MyListing.Helpers.debounce(function(e,t){this.isMobile&&!0!==t||this._getListings(e)},500),getListingsShort:MyListing.Helpers.debounce(function(e,t){this.isMobile&&!0!==t||this._getListings(e)},250),filterChanged:function(e,t){this.isMobile&&"primary-filter"!==t.location&&!t.forceGet&&!this.activeType.is_first_load||(!1===t.shouldDebounce?this._getListings("".concat(t.filterType,":").concat(t.filterKey)):this.getListings("".concat(t.filterType,":").concat(t.filterKey),!0))},_getListings:function(t){"dev"===CASE27.env&&console.log("%c Get Listings ["+t+"]","background-color: darkred; color: #fff;"),this.loading=!0;var e,i=this,s=this.activeType,r=(this.activeType.filters.preserve_page||(this.activeType.filters.page=0),this.activeType.taxonomies[this.activeType.tab]),r={form_data:void 0!==r&&0!==r.activeTermId?{context:"term-search",taxonomy:r.tax,term:r.activeTermId,page:(["load-more","next-page","previous-page"].includes(t)?this.activeType.filters:r).page,sort:this.activeType.filters.sort,search_location:this.activeType.filters.search_location,lat:this.activeType.filters.lat,lng:this.activeType.filters.lng,proximity:this.activeType.filters.proximity,proximity_units:this.activeType.filters.proximity_units}:this.activeType.filters,listing_type:this.activeType.slug,listing_wrap:CASE27_Explore_Settings.ListingWrap,proximity_units:this.proximity_units},n=(CASE27_Explore_Settings.DisplayAd&&CASE27_Explore_Settings.AdPublisherID&&CASE27_Explore_Settings.AdSlotID&&CASE27_Explore_Settings.AdInterval&&(r.display_ad=CASE27_Explore_Settings.DisplayAd,r.pub_id=CASE27_Explore_Settings.AdPublisherID,r.slot_id=CASE27_Explore_Settings.AdSlotID,r.ad_interval=CASE27_Explore_Settings.AdInterval),JSON.stringify(r));this.activeType.last_response&&n===this.activeType.last_request_body?("dev"===CASE27.env&&console.warn("Ignoring call to getListings, no search arguments have changed."),e=this.activeType.last_response,this.updateUrl(),setTimeout(function(){this.loading=!1,this.activeType.last_response&&this.updateView(e,t)}.bind(this),200)):("dev"===CASE27.env&&this.activeType.last_request_body&&(console.log("%c Getting listings, arguments diff:","color: #a370ff"),console.table(objectDiff(JSON.parse(this.activeType.last_request_body).form_data,JSON.parse(n).form_data))),this.updateUrl(),jQuery.ajax({url:CASE27.mylisting_ajax_url+"&action=get_listings&security="+CASE27.ajax_nonce,type:"GET",dataType:"json",data:r,beforeSend:function(e,t){i.last_request&&i.last_request.abort(),i.last_request=e},success:function(e){"object"===a(e)&&("search-form"===s.tab&&(s.last_response=e,s.last_request_body=n),s.slug===i.activeType.slug)&&(i.loading=!1,i.updateView(e,t))}}))},updateUrl:function(){var r,n,e;return!(!window.history||CASE27_Explore_Settings.DisableLiveUrlUpdate||(r=this.activeType.filters,n={},!window.location.search&&CASE27_Explore_Settings.IsFirstLoad))&&(n.type=this.activeType.slug,this.activeType.tab!==this.activeType.defaultTab&&(n.tab=this.activeType.tab),"search-form"===this.activeType.tab&&Object.keys(r).forEach(function(e){var t,i=r[e],s=e;return"proximity_units"!=e&&(("lat"===e||"lng"===e)&&i&&void 0!==r.search_location&&r.search_location.length&&(s=e,t=-1<i.toString().indexOf("-")?9:8,i=i.toString().substr(0,t)),!!("proximity"!=e||r.lat&&r.lng))&&("page"===e&&0<i&&(i+=1,s="pg"),void((i&&void 0!==i.length&&i.length||"number"==typeof i&&i)&&(n[s]=i)))}),"load-more"===this.pagination&&delete n.pg,void(this.currentTax&&this.currentTax.activeTerm?(e=this.currentTax.activeTerm.link,0<this.currentTax.page&&(e=this.updateUrlParameter(e,"pg",this.currentTax.page+1)),window.history.replaceState(null,null,e)):(e=jQuery.param(n).replace(/%2C/g,","),window.history.replaceState(null,null,this.baseUrl+(e.trim().length?"?"+e:"")))))},_triggerCarousel:function(){this.$nextTick(function(){MyListing.BackgroundCarousel()})},updateView:function(e,t){var i,s,r,n,a,o,l=this,c=(this._triggerCarousel(),e),u=this;this.activeType.is_first_load=!1,this.found_posts=e.found_posts,this.$emit("update-results",e,t),this.activeType.filters.preserve_page=!1,jQuery(".fc-type-2 .finder-overlay").on("click",function(){jQuery(".fc-type-2").removeClass("fc-type-2-open")}),this.isotope&&(i=jQuery("body").hasClass("rtl")?jQuery(".grid").isotope({originLeft:!1}):jQuery(".grid").isotope(),jQuery(".explore-mobile-nav > ul li").on("click",function(){setTimeout(function(){i.isotope("reloadItems").isotope()},400)}),jQuery("body").on("click",".fc-search .close-filters-27",function(){i.isotope("reloadItems").isotope()}),jQuery(".tab-switch").click(function(e){e.preventDefault(),setTimeout(function(){i.isotope("reloadItems").isotope()},400)})),jQuery(".finder-listings .results-view").length&&("load-more"===t?jQuery(".finder-listings .results-view").append(c.html):jQuery(".finder-listings .results-view").html(c.html)),jQuery(".fc-type-2-results").length&&("load-more"===t?jQuery(".fc-type-2-results").append(c.html):jQuery(".fc-type-2-results").html(c.html)),0<this.compare.length&&jQuery(".finder-listings .results-view .lf-item-container").each(function(e,t){var t=jQuery(t),i=parseInt(t.data("id").replace("listing-id-",""),10);u.compare.includes(i)&&(t.addClass("compare-chosen"),t.find(".c27-compare-button i").removeClass("add").addClass("remove"))}),this.isotope&&(s=jQuery(".finder-container .fc-default .finder-listings"),r=jQuery(".fc-type-2"),jQuery(".fc-one-column").length&&(s=jQuery(".fc-one-column")),n=(s=r.length?jQuery(window):s).find(".results-view"),a=s.scrollTop(),window.matchMedia("(max-width: 1200px)").matches&&(a=window.pageYOffset),"load-more"===t&&jQuery(".finder-container .fc-default .finder-listings .results-view").css("min-height",n.outerHeight()+"px"),o=function(){"load-more"===t&&(r.length?r.find(".explore-classic-content"):s).css("opacity",0),void 0!==jQuery(".results-view.grid").data("isotope")&&jQuery(".results-view.grid").isotope("destroy");var e={itemSelector:".grid-item"};jQuery("body").hasClass("rtl")&&(e.originLeft=!1),jQuery(".results-view.grid").isotope(e),"load-more"===t&&(s.scrollTop(a),n.css("min-height","auto"),(r.length?r.find(".explore-classic-content"):s).css("opacity",1),window.matchMedia("(max-width: 1200px)").matches)&&window.scrollTo(0,a)}),setTimeout(function(){jQuery(l.$el).find("ins").each(function(e,t){"done"!==t.dataset.adsbygoogleStatus&&(adsbygoogle=window.adsbygoogle||[]).push({})}),l.isotope&&setTimeout(function(){return o()},10)},10),this.isotope&&setTimeout(function(){return o()},10),jQuery(".c27-explore-pagination").length&&(jQuery(".c27-explore-pagination").html(c.pagination),jQuery(".c27-explore-pagination a").each(function(){var e=jQuery(this).data("page"),t=window.location.href;jQuery(this).attr("href",u.updateUrlParameter(t,"pg",e))})),50<CASE27_Explore_Settings.ScrollPosition?setTimeout(function(){var e=CASE27_Explore_Settings.ScrollPosition;(l.isMobile?jQuery(document):jQuery(".finder-listings")).scrollTop(e),CASE27_Explore_Settings.ScrollPosition=0},30):(jQuery(".finder-container .fc-one-column").length&&CASE27_Explore_Settings.ScrollToResults&&jQuery(".finder-container .fc-one-column").animate({scrollTop:jQuery(".finder-search").outerHeight()}),window.matchMedia("(min-width: 1200px)").matches?(jQuery(".finder-container .fc-default .finder-listings").length&&"load-more"!==t&&jQuery(".finder-container .fc-default .finder-listings").animate({scrollTop:0}),"pagination"===t&&!CASE27_Explore_Settings.ScrollToResults&&jQuery(".finder-container .fc-one-column").length&&jQuery(".finder-container .fc-one-column").animate({scrollTop:jQuery(".finder-search").outerHeight()}),"pagination"===t&&jQuery("html, body").animate({scrollTop:jQuery(this.$el).offset().top})):"results"===this.state.mobileTab&&"load-more"!==t&&this._resultsScrollTop()),this.updateMap(),CASE27_Explore_Settings.IsFirstLoad=!1},infiniteScroll:MyListing.Helpers.debounce(function(e){"load-more"===this.pagination&&this.infinite_scroll&&(e=e.target).scrollHeight-e.scrollTop<=e.clientHeight+100&&this.$refs.loadMoreComponent.loadMore()},200),infiniteScrollMobile:MyListing.Helpers.debounce(function(){window.innerHeight+window.scrollY>=document.body.offsetHeight-100&&this.$refs.loadMoreComponent.loadMore()},200),_resultsScrollTop:function(){jQuery("html, body").animate({scrollTop:jQuery("#c27-explore-listings").offset().top-100},"slow")},_compareListing:function(){jQuery("#comparison-view").modal("show").addClass("loading-modal"),jQuery("#comparison-view .modal-dialog").hide(),jQuery("#comparison-view .loader-bg").show(),jQuery.ajax({url:CASE27.mylisting_ajax_url+"&action=compare_listings&security="+CASE27.ajax_nonce,type:"GET",dataType:"json",data:{listing_ids:this.compare},success:function(e){"object"===a(e)&&(jQuery("#comparison-view").removeClass("loading-modal"),jQuery("#comparison-view .modal-content").html(e.html),jQuery("#comparison-view .loader-bg").hide(),jQuery("#comparison-view .modal-dialog").show())}})},_clearCompareListing:function(){this.compare=[],jQuery(".lf-item-container.compare-chosen .c27-compare-button i").removeClass("remove").addClass("add"),jQuery(".lf-item-container.compare-chosen").removeClass("compare-chosen")},setupMap:function(){var i=this,e=jQuery(this.$el).find(".finder-map .map").attr("id");if(!MyListing.Maps.getInstance(e))return!1;this.map=MyListing.Maps.getInstance(e).instance;var t,s,r,e=this.map;MyListing.Geocoder.setMap(e),CASE27_Explore_Settings.DragSearchEnabled&&(t=MyListing.Helpers.debounce(function(){var e,t;i.isMobile&&"map"!==i.state.mobileTab&&(i.suspendDragSearch=!0),!i.dragSearch||i.suspendDragSearch||(e=i.map.getCenter(),i.activeType.filters.lat=e.getLatitude(),i.activeType.filters.lng=e.getLongitude(),i.activeType.filters.search_location=CASE27_Explore_Settings.DragSearchLabel,e=i.map.getDimensions(),e=Math.max(e.width,e.height)/2,(t=i.$refs["".concat(i.activeType.slug,"_proximity")])&&"mi"===t.units&&(e/=1.609),i.activeType.filters.proximity=Math.round(100*e)/100,jQuery("body").hasClass("modal-open"))||jQuery("body").hasClass("modal-closed")||i._getListings("map_drag")},300,{leading:!0,trailing:!1}),this.map.addListenerOnce("updated_markers",function(){setTimeout(function(){var e="mapbox"===i.mapProvider||"free-map"===i.mapProvider?"moveend":"idle";i.map.addListener(e,t)},100)})),navigator.geolocation&&(s=!1,r=this,(e=document.getElementById("explore-map-location-ctrl")).addEventListener("click",function(){navigator.geolocation.getCurrentPosition(function(e){r.setCircle(!0,e.coords.latitude,e.coords.longitude)},function(e){(s=s||new MyListing.Dialog({message:CASE27.l10n.geolocation_failed})).visible||(s.refresh(),s.show())})}),this.map.addControl(e))},setCircle:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=(1<arguments.length?arguments[1]:void 0)||this.activeType.filters.lat,i=(2<arguments.length?arguments[2]:void 0)||this.activeType.filters.lng,s=this;if(s.circleMarker&&s.circle&&(s.map.removecircleMarker(s.circleMarker),s.map.removeCircle(s.circle),s.circle=null,s.circleMarker=null),!t||!i)return null;var r=s.activeType.filters.proximity||.01,n=jQuery(".explore-filter.proximity-filter").data("units"),t=new MyListing.Maps.LatLng(t,i),i=(s.circleMarker=new MyListing.Maps.Marker({position:t,map:s.map,template:{type:"user-location"}}),e&&(s.suspendDragSearch=!0,s.map.setZoom(CASE27_Explore_Settings.Map.default_zoom),s.map.setCenter(s.circleMarker.getPosition())),s.circle=s.map.setCircle(s.circleMarker.getPosition(),r,n,s.map),"mapbox"===s.mapProvider?"moveend":"idle");s.map.addListener(i,function(){setTimeout(function(){e&&(s.suspendDragSearch=!1)},300)})},removeCircle:function(){var e,t=this;t.map?t.circleMarker&&t.circle&&(t.map.removeCircle(t.circle),t.map.removecircleMarker(t.circleMarker),t.circle=null,t.circleMarker=null):document.getElementsByClassName("finder-map").length&&(e=setInterval(function(){t.map&&(clearInterval(e),t.removeCircle())},200))},calculateDistance:function(e,t,i,s){var r="km"===(4<arguments.length&&void 0!==arguments[4]?arguments[4]:"km")?6371:3959,n=this.toRad(i-e),s=this.toRad(s-t),t=Math.sin(n/2)*Math.sin(n/2)+Math.cos(this.toRad(e))*Math.cos(this.toRad(i))*Math.sin(s/2)*Math.sin(s/2);return r*(2*Math.atan2(Math.sqrt(t),Math.sqrt(1-t)))},toRad:function(e){return e*Math.PI/180},updateMap:function(){var e,r,n=this,a=n.proximity_units,o=n.activeType.filters.proximity,l=n.activeType.filters.lat,c=n.activeType.filters.lng;n.map?(n.map.$el.removeClass("mylisting-map-loading"),n.map.removeMarkers(),n.map.trigger("updating_markers"),r=new MyListing.Maps.LatLngBounds,jQuery(this.$el).find(".results-view .lf-item-container").each(function(e,t){var i,s=jQuery(t);s.data("locations")&&(t=s.data("locations"),l&&c&&o?(i=Object.values(t).filter(function(e){return n.calculateDistance(l,c,e.lat,e.lng,a)<=o}),jQuery.each(i,function(e,t){n.markerGenerator(t,s,n,r)})):jQuery.each(Object.values(t),function(e,t){n.markerGenerator(t,s,n,r)}))}),this.dragSearch&&!CASE27_Explore_Settings.IsFirstLoad||(r.empty()||n.map.fitBounds(r),17<n.map.getZoom()&&n.map.setZoom(17)),n.map.trigger("updated_markers"),this.setCircle(!!r.empty())):document.getElementsByClassName("finder-map").length&&(e=setInterval(function(){n.map&&(clearInterval(e),n.updateMap())},200))},markerGenerator:function(e,t,i,s){e=new MyListing.Maps.Marker({position:new MyListing.Maps.LatLng(e.lat,e.lng),map:i.map,popup:new MyListing.Maps.Popup({content:'<div class="lf-item-container lf-type-2">'+t.html()+"</div>"}),template:{type:"advanced",thumbnail:t.data("thumbnail"),marker:t.data("marker"),icon_name:t.data("category-icon"),icon_background_color:t.data("category-color"),icon_color:t.data("category-text-color"),listing_id:t.data("id")}});i.map.markers.push(e),s.extend(e.getPosition())},resetFilters:function(e){var t;e&&e.target&&((t=jQuery(e.target).find("i")).removeClass("fa-spin"),setTimeout(function(){t.addClass("fa-spin")},5)),this.$emit("reset-filters"),this.$emit("reset-filters:"+this.activeType.slug)},jQueryReady:function(){var i=this;jQuery(function(t){t("body").on("click",".c27-explore-pagination a",function(e){e.preventDefault();e=parseInt(t(this).data("page"),10)-1;i.activeType.taxonomies[i.activeType.tab]&&(i.activeType.taxonomies[i.activeType.tab].page=e),i.activeType.filters.page=e,i.activeType.filters.preserve_page=!0,i._getListings("pagination")}),jQuery(".col-switch").click(function(e){i.map.trigger("resize")}),jQuery("body").on("mouseenter",".results-view .lf-item-container.listing-preview",function(){jQuery(".marker-container .marker-icon."+jQuery(this).data("id")).addClass("active")}),jQuery("body").on("mouseleave",".results-view .lf-item-container.listing-preview",function(){jQuery(".marker-container .marker-icon."+jQuery(this).data("id")).removeClass("active")})})},termsExplore:function(e,t,s){var r=this,n=(this.activeType.tab=e,this.activeType.taxonomies[this.activeType.tab]),s=s||!1,e=this.activeType.tabs[this.activeType.tab]||{};if(!n.termsLoading){"active"===t&&(t=n.activeTerm),n.activeTerm=!1,s||(n.terms=!1),"object"===a(t)&&t.term_id?(n.activeTermId=t.term_id,n.activeTerm=t):isNaN(parseInt(t,10))?n.activeTermId=0:n.activeTermId=t,this.activeType.filters.preserve_page||(this.currentTax.page=0);jQuery(".search-filters.type-id-"+this.activeType.id+" .orderby-filter").hasClass("has-proximity-clause")?this.$emit("request-location:"+this.activeType.slug):this._getListings("terms-explore"),void 0===CASE27_Explore_Settings.TermCache[this.activeType.slug]&&(CASE27_Explore_Settings.TermCache[this.activeType.slug]={}),void 0===CASE27_Explore_Settings.TermCache[this.activeType.slug][n.tax]&&(CASE27_Explore_Settings.TermCache[this.activeType.slug][n.tax]={});var i=CASE27_Explore_Settings.TermCache[this.activeType.slug][n.tax][n.activeTermId];if(i){if(!(s&&i.hasMore||void 0===i.pages[n.termsPage]))return n.activeTerm=i.details,n.hasMore=i.hasMore,n.terms=[],Object.keys(i.pages).forEach(function(t){Object.keys(i.pages[t]).forEach(function(e){n.terms.push(i.pages[t][e])})}),void this.updateUrl();n.termsPage=i.currentPage+1}else n.termsPage=0;n.termsLoading=!0,jQuery.ajax({url:CASE27.mylisting_ajax_url+"&action=explore_terms&security="+CASE27.ajax_nonce,type:"GET",dataType:"json",data:{taxonomy:n.tax,parent_id:n.activeTermId,type_id:this.activeType.id,page:n.termsPage,per_page:CASE27_Explore_Settings.TermSettings.count,orderby:e.orderby,order:e.order,hide_empty:e.hide_empty?"yes":"no"},success:function(t){if(n.termsLoading=!1,1!=t.success)return new MyListing.Dialog({message:t.message});var i=CASE27_Explore_Settings.TermCache[r.activeType.slug][n.tax];i[n.activeTermId]||(i[n.activeTermId]={details:{},pages:{}}),n.activeTerm=t.details,n.hasMore=t.more,i[n.activeTermId].details=t.details,i[n.activeTermId].hasMore=t.more,i[n.activeTermId].currentPage=n.termsPage,i[n.activeTermId].pages[n.termsPage]=t.children,s?Object.keys(t.children).forEach(function(e){n.terms.push(t.children[e])}):(n.terms=[],Object.keys(i[n.activeTermId].pages).forEach(function(t){Object.keys(i[n.activeTermId].pages[t]).forEach(function(e){n.terms.push(i[n.activeTermId].pages[t][e])})})),r.updateUrl()}})}},termsGoBack:function(e){this.termsExplore(this.activeType.tab,e.parent),0!==parseInt(e.parent,10)&&(this.currentTax.page=0,this.getListings("terms-go-back"))},updateUrlParameter:function(e,t,i){var s=e.indexOf("#"),r=-1===s?"":e.substr(s),s=(e=-1===s?e:e.substr(0,s),new RegExp("([?&])"+t+"=.*?(&|$)","i")),n=-1!==e.indexOf("?")?"&":"?";return(e=e.match(s)?e.replace(s,"$1"+t+"="+i+"$2"):e+n+t+"="+i)+r},hasValidLocation:function(e){return!!this.types[e]&&(e=this.types[e].filters).lat&&e.lng&&e.search_location},toggleMap:function(e){var t=this;this.mapExpanded=e,this.map.mapExpanded=e,setTimeout(function(){return t.map.trigger("refresh")},5)}},computed:{currentTax:function(){return this.activeType.taxonomies[this.activeType.tab]},currentTermName:function(){var e=this.currentTax.activeTerm?this.currentTax.activeTerm.name:"&nbsp;";return'<h1 class="category-name">'.concat(e,"</h1>")},showBackToFilters:function(){var e=this.activeType.tabs;return e["search-form"]&&(this.isMobile||1===Object.keys(e).length)},containerStyles:function(){var e,t="top:0;";return this.isMobile||(e=document.querySelector("header.header"))&&(e=e.getBoundingClientRect(),t+="height: calc(100vh - ".concat(Math.round(e.height+e.y),"px);")),t}},watch:{activeType:function(){var e,t;this.activeType&&("search-form"===this.activeType.tab?(t=jQuery(".search-filters.type-id-"+this.activeType.id+" .orderby-filter"),e=this.activeType.filters.search_location&&!(this.activeType.filters.lat||this.activeType.filters.lng),this.activeType.last_response?"load-more"===this.pagination?this._getListings("switch-listing-type"):(this.loading=!1,this.updateUrl(),this.updateView(this.activeType.last_response,"switch-listing-type")):t.hasClass("has-proximity-clause")||e?this.$emit("request-location:"+this.activeType.slug):this._getListings("switch-listing-type")):(t=parseInt(this.activeType.taxonomies[this.activeType.tab].activeTermId,10),isNaN(t)||0===t?this.termsExplore(this.activeType.tab):this.termsExplore(this.activeType.tab,"active")))}}}))},MyListing.Explore_Init(),document.addEventListener("DOMContentLoaded",MyListing.Explore_Init)});
