!function(e){"function"==typeof define&&define.amd?define("addListing",e):e()}(function(){"use strict";function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,a,o,r,d=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=o.call(n)).done)&&(d.push(i.value),d.length!==t);l=!0);}catch(e){c=!0,a=e}finally{try{if(!l&&null!=n.return&&(r=n.return(),Object(r)!==r))return}finally{if(c)throw a}}return d}}(e,t)||function(e,t){var n;if(e)return"string"==typeof e?i(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}jQuery(function(c){var s,f,u,p;c(".file-upload-field.multiple-uploads .job-manager-uploaded-files").sortable({helper:"clone",appendTo:document.body}),c('.c27-work-hours .day-wrapper .work-hours-type input[type="radio"]').on("change",function(e){c(this).val();c(this).parents(".day-wrapper").removeClass(["day-status-enter-hours","day-status-closed-all-day","day-status-open-all-day","day-status-by-appointment-only"].join(" ")).addClass("day-status-"+c(this).val())}),c(".form-group .c27-work-hours, .ml-admin-listing-form .c27-work-hours").length&&(p=[],c(".form-group .c27-work-hours, .ml-admin-listing-form .c27-work-hours").each(function(){s=c(this)}),s.find(".copy-schedule").on("click",function(e){e.preventDefault(),c(this).siblings(".copy-hours-wrapper").toggleClass("hidden"),f=s.find(".work-hours-message").val(),u=s.find(".work-hours-message").attr("nodays")}),s.find(".copy-hours-wrapper .md-checkbox").each(function(e,t){c(t).find("input").on("change",function(){var e,t,n;c(this).is(":checked")?(e=c(this).data("day"),t=c(this).siblings("label").html(),(n={})[e]=t,p.push(n)):p.splice(p.indexOf(c(this).data("day")),1)})}),s.find(".copy-confirm").on("click",function(e){if(e.preventDefault(),p.length){for(var t="",n=0,i=p;n<i.length;n++)for(var a=i[n],o=0,r=Object.entries(a);o<r.length;o++){var d=h(r[o],2),l=d[0],d=d[1];!function(e){var t,n=c(".days .nav-tabs > li.active").find("a").attr("aria-controls"),i=c("#"+n).find(".work-hours-type > div input:checked").val(),e=c.isNumeric(e)||"all"!==e?c(".days .nav-tabs > li").eq(e-1):c(".days .nav-tabs > li:not(.active)"),a=[];"enter-hours"===i&&(n=c("#"+n).find(".work-hours-repeater > div li.day"),t=n.length,n.each(function(e,t){var n=c(t).find("span.select2-container:first-of-type .select2-selection__rendered").attr("title"),t=c(t).find("span.select2-container:nth-of-type(2) .select2-selection__rendered").attr("title");a.push({from:n,to:t})})),c(e).each(function(){var n=c(this).find("a").attr("aria-controls");c("#"+n).find(".work-hours-repeater > div li.day").length;c("#"+n).find(".work-hours-type > div input[value="+i+"]").click(),c("#"+n).find(".work-hours-repeater > div li.day").remove();for(var e=1;e<=t;e++)c("#"+n).find(".work-hours-repeater > input[type=button].add-row-button").click();a.forEach(function(e,t){t+=1;c("#".concat(n," .work-hours-repeater > div li.day:nth-of-type(").concat(t,")")).find("span.select2-container:nth-of-type(1) .select2-selection__rendered").attr("title",e.from).html(e.from),c("#".concat(n," .work-hours-repeater > div li.day:nth-of-type(").concat(t,")")).find("select.select2-hidden-accessible:nth-of-type(1)").val(moment(e.from,"h:mm a").format("HH:mm")),c("#".concat(n," .work-hours-repeater > div li.day:nth-of-type(").concat(t,")")).find("span.select2-container:nth-of-type(2) .select2-selection__rendered").attr("title",e.to).html(e.to),c("#".concat(n," .work-hours-repeater > div li.day:nth-of-type(").concat(t,")")).find("select.select2-hidden-accessible:nth-of-type(2)").val(moment(e.to,"h:mm a").format("HH:mm"))})})}(l),t+=" "+d}p=[],s.find(".copy-hours-wrapper .md-checkbox input").prop("checked",!1),c(".c27-submit-listing-form").length?new MyListing.Dialog({message:f+" "+t}):c(".ml-admin-listing-form").length&&alert(f+" "+t),c(".copy-hours-wrapper").addClass("hidden")}else c(".c27-submit-listing-form").length?new MyListing.Dialog({message:u}):c(".ml-admin-listing-form").length&&alert(u)}),s.find(".days .nav-tabs > li").on("click",function(){var e=c(this).index()+2;c(".copy-hours-wrapper").addClass("hidden").find(".md-checkbox:nth-child("+e+")").addClass("hidden").siblings().removeClass("hidden"),s.find(".copy-hours-wrapper .md-checkbox input").prop("checked",!1)}))}),jQuery(function(i){var o,r,e,t,a,n={};(e=i("#submit-job-form .form-section-wrapper")).length<=1||(o=70*window.innerHeight/100,r=5*window.innerHeight/100,i(window).on("scroll",MyListing.Helpers.debounce(function(){var a=[],t=(e.each(function(e,t){var n=t.getBoundingClientRect(),i=o-n.top,n=r-n.top;0<=i&&a.push({el:t,diff:i,max_diff:n})}),e.removeClass("active"),n.Nav.clearAll(),!1);a.reverse().forEach(function(e){t?e.max_diff<=0&&(e.el.classList.add("active"),n.Nav.highlight(e.el.id)):(e.el.classList.add("active"),t=!0,n.Nav.highlight(e.el.id))})},20)).scroll()),t=i("#submit-job-form .form-section-wrapper:not(#form-section-submit)"),(a=i(".add-listing-nav")).length&&(n.Nav={clearAll:function(){a.find("li").removeClass("active")},highlight:function(e){e=a.find("#"+e+"-nav");e.length&&e.addClass("active")}},t.length<=1?a.hide():t.each(function(e,t){var n=i(this).find(".pf-head h5").html();"string"==typeof n&&((n=i('<li id="'+i(this).attr("id")+'-nav"><a href="#"><i><span></span></i>'+n+"</a></li>")).click(function(e){e.preventDefault(),i("html, body").animate({scrollTop:i(t).offset().top-5*window.innerHeight/100-90})}),a.find("ul").append(n))}))}),jQuery(function(v){v(".event-picker").each(function(){var t=v(this),e=t.data("dates"),o=t.data("key"),n=t.data("limit"),r="no"!==t.data("timepicker"),y=t.data("l10n"),d=t.find(".dates-list"),i=t.find(".date-add-new"),a=e.length+1,l=t.find(".datetpl").text();function c(){var e=t.find(".single-date").length;n<=e?i.hide():i.show(),e<1&&s()}function s(){f({start:"",end:"",repeat:!1,frequency:2,unit:"weeks",until:moment().add(1,"years").locale("en").format("YYYY-MM-DD"),index:a++})}function f(e){var t=v(l.replace(/{date}/g,o+"["+e.index+"]")),s=t.find(".is-recurring input"),f=t.find(".date-start input"),u=t.find(".date-end input"),p=t.find(".repeat-frequency input"),h=t.find(".repeat-unit"),m=t.find(".repeat-message"),g=t.find(".repeat-end input");function n(){if(s.prop("checked")){var e=f.val(),t=u.val(),n=g.val(),i=parseInt(p.val(),10),a=h.find("input:checked").val();if(e.length&&t.length&&n.length&&i){e=moment(e),t=moment(t),(n=moment(n)).set({hour:23,minute:59,second:59}),"weeks"===a&&(a="days",i*=7),"years"===a&&(a="months",i*=12);for(var n=Math.abs(e.diff(n,a)),o=Math.floor(n/i),r=[],d=1;d<Math.min(o+1,6);d++){var l=e.clone().add(i*d,a),c=t.clone().add(i*d,a);r.push("".concat(l.format(CASE27.l10n.datepicker.format)," - ").concat(c.format(CASE27.l10n.datepicker.format)))}n=y.next_five.replace("%d",o);o<1?n=y.no_recurrences:o<5&&(n=y.next_recurrences),m.show().html("<span>".concat(n,'</span><ul class="no-list-style"><li>').concat(r.join("</li><li>"),"</li></ul>"))}else m.hide()}}f.val(e.start),u.val(e.end),s.prop("checked",e.repeat),p.val(e.frequency),h.find('input[value="'.concat(e.unit,'"]')).prop("checked",!0),g.val(e.until),e.repeat&&t.find(".recurrence").addClass("is-open"),s.on("change",function(){n(),v(this).prop("checked")?t.find(".recurrence").addClass("is-open"):t.find(".recurrence").removeClass("is-open")});new MyListing.Datepicker(f,{timepicker:r});var i=new MyListing.Datepicker(u,{timepicker:r}),a=new MyListing.Datepicker(g);e.start&&t.find(".date-start").removeClass("date-empty"),e.end&&t.find(".date-end").removeClass("date-empty"),f.on("datepicker:change",function(e){i.setMinDate(moment(e.detail.value)),s.length&&a.setMinDate(moment(e.detail.value)),n(),e.detail.value?t.find(".date-start").removeClass("date-empty"):t.find(".date-start").addClass("date-empty")}),u.on("datepicker:change",function(e){n(),e.detail.value?t.find(".date-end").removeClass("date-empty"):t.find(".date-end").addClass("date-empty")}),g.on("datepicker:change",n),p.on("input",n),h.find("input").on("change",n),n(),d.append(t)}e.forEach(function(e,t){f({start:e.start,end:e.end,repeat:e.repeat,frequency:e.repeat?e.frequency:2,unit:e.repeat?e.unit:"weeks",until:e.repeat?e.until:moment(e.start).add(1,"years").locale("en").format("YYYY-MM-DD"),index:t})}),e.length||s(),i.click(function(e){e.preventDefault(),f({start:"",end:"",repeat:!1,frequency:2,unit:"weeks",until:moment().add(1,"years").locale("en").format("YYYY-MM-DD"),index:a++}),c()}),v(this).on("click",".remove-date",function(e){e.preventDefault(),v(this).parents(".single-date").remove(),c()}),c()})}),jQuery(function(m){MyListing.Maps&&MyListing.Maps.loaded&&(m(".repeater-custom").each(function(e,t){var p=parseInt(m(t).data("max"),10),h=m(t).find(".add-location");m(t).repeater({initEmpty:!0,ready:function(e){},hide:function(e){var n=m(this).find(".location-field-wrapper").data("index");MyListing.Maps.instances;MyListing.Maps.instances.forEach(function(e,t){e.id==n&&delete MyListing.Maps.instances[t]}),MyListing.Maps.instances=MyListing.Maps.instances.filter(function(e){return null!==e}),e(),m("div[data-repeater-item] > .location-field-wrapper").length>=p?h.hide():h.show()},show:function(){var e=this,t=(m(e).show(),m("div[data-repeater-item] > .location-field-wrapper")),n=m(e).find(".delete-repeater-item"),n=(t.length>=p?h.hide():h.show(),1==p?n.hide():n.show(),t.eq(-2).length?(n=t.eq(-2).data("index"),m(e).find(".location-field-wrapper").attr("data-index",n+1),m(e).find(".location-picker-custom-map").attr("id",n+1),m(e).find('.lock-pin input[type="checkbox"]').attr("id","location__lock_pin_"+n+1),m(e).find(".locked").attr("for","location__lock_pin_"+n+1),m(e).find(".unlocked").attr("for","location__lock_pin_"+n+1)):(m(e).find(".location-field-wrapper").attr("data-index",t.length-1),m(e).find(".location-picker-custom-map").attr("id",t.length-1),0<t.length-1&&(m(e).find('.lock-pin input[type="checkbox"]').attr("id","location__lock_pin_"+t.length-1),m(e).find(".locked").attr("for","location__lock_pin_"+t.length-1),m(e).find(".unlocked").attr("for","location__lock_pin_"+t.length-1))),new MyListing.Maps.Map(m(e).find(".c27-custom-map:not(.delay-init)").get(0)),new MyListing.Maps.Autocomplete(m(e).find(".address-field").get(0)),m(e).find(".location-field-wrapper")),t=m(e).find(".location-picker-custom-map").attr("id"),i=MyListing.Maps.getInstance(t).instance,a=(m(e).find(".cts-custom-get-location").on("click",function(e){e.preventDefault();var t=jQuery(jQuery(this).parents(".repeater-item"));t.find(".cts-custom-get-location").length&&(i&&MyListing.Geocoder.setMap(i.instance),MyListing.Geocoder.getUserLocation({receivedAddress:function(e){if(t.find(".address-field").val(e.address),t.find(".address-field").data("autocomplete"))return t.find(".address-field").data("autocomplete").fireChangeEvent(e)}}))}),n.data("options")),o=n.find(".location-coords"),r=n.find(".latitude-input"),d=n.find(".longitude-input"),l=n.find(".address-field"),c=n.find('.lock-pin input[type="checkbox"]'),t=n.find(".enter-coordinates-toggle > span"),s=new MyListing.Maps.Marker({position:u(),map:i,template:{type:"traditional"}});function f(){var e=u();s.setPosition(e),i.panTo(e),""!==r.val().trim()&&""!==d.val().trim()&&(r.val(e.getLatitude()),d.val(e.getLongitude()))}function u(){return r.val().trim()&&d.val().trim()?new MyListing.Maps.LatLng(r.val(),d.val()):new MyListing.Maps.LatLng(a["default-lat"],a["default-lng"])}i.addListener("click",function(e){c.prop("checked")||(e=i.getClickPosition(e),s.setPosition(e),r.val(e.getLatitude()),d.val(e.getLongitude()),MyListing.Geocoder.geocode(e.toGeocoderFormat(),function(e){e&&l.val(e.address)}))}),l.on("autocomplete:change",function(e){var t;!c.prop("checked")&&e.detail.place&&e.detail.place.latitude&&e.detail.place.longitude&&(t=new MyListing.Maps.LatLng(e.detail.place.latitude,e.detail.place.longitude),s.setPosition(t),r.val(e.detail.place.latitude),d.val(e.detail.place.longitude),i.panTo(t))}),i.addListenerOnce("free-map"===CASE27.map_provider?"moveend":"idle",function(e){i.setZoom(a["default-zoom"])}),c.on("change",function(e){i.trigger("resize"),i.setCenter(u())}).change(),t.click(function(e){o.toggleClass("hide")}),r.blur(f),d.blur(f)}}).setList(m(t).data("list"))}),jQuery(".field-type-location .address-field").each(function(e,t){new MyListing.Maps.Autocomplete(t)}),jQuery(".cts-custom-get-location").each(function(e,t){jQuery(t).on("click",function(e){e.preventDefault();var t=jQuery(jQuery(this).parent(".repeater-item"));t.find(".cts-custom-get-location").length&&((e=MyListing.Maps.getInstance(jQuery(this)))&&MyListing.Geocoder.setMap(e.instance),MyListing.Geocoder.getUserLocation({receivedAddress:function(e){if(t.find(".cts-custom-get-location").val(e.address),t.find(".cts-custom-get-location").data("autocomplete"))return t.find(".cts-custom-get-location").data("autocomplete").fireChangeEvent(e)}}))})}))}),jQuery(function(n){setTimeout(function(){n("#submit-job-form .wp-editor-wrap").css("height","auto")},2500),n(".save-listing-button").on("click",function(e){n("input[required], select[required]").removeAttr("required")}),n("body").hasClass("add-listing-form")&&(document.addEventListener("invalid",function(e){jQuery(e.target).addClass("invalid"),jQuery("html, body").animate({scrollTop:jQuery(jQuery(".invalid")[0]).offset().top-150},0)},!0),document.addEventListener("change",function(e){jQuery(e.target).removeClass("invalid")},!0)),n(".file-upload-field").on("click touchstart",".job-manager-remove-uploaded-file",function(){return n(this).closest(".job-manager-uploaded-file").remove(),!1}),n("#submit-job-form").on("submit",function(e){n(".add-listing-loader").show().removeClass("loader-hidden")}),n(".field-type-number").each(function(e,t){n(t).find('input[type="number"]').on("wheel",function(e){e.preventDefault()})})})});
